## HashMap

### 比较map集合

1.8之前 数组+链表（拉链法）

1.8之后 默认长度16，链表长度超过默认阈值8且数组长度超过64，升级红黑树，小于6退化

LinkedHashMap 双向链表控制插入、访问顺序

HashTable 线程安全 (基本都上锁)

TreeMap 红黑树 按比较规则排序

ConcurrentHashMap 线程安全 1.8以前数组Segment锁，之后volatie+CAS（容器为空）cas(value空),Synchronized(value不空)

### 哈希算法

拉链、开放寻址、再哈希、动态扩容

### put过程

...->检查负载因子（键值对数/数组长度 <= 默认0.75）->...

### 红黑树

平衡二叉树 左右子树严格相差1之内（强平衡）

红黑树弱平衡，满足红黑规则（优势在于弱平衡实际更好用）

### 多线程出现问题

1. jdk1.8之前 头插法扩容时环形链表，jdk1.8之后 尾插法
2. 覆盖，键值对丢失

### 扩容，为什么2倍、2的n次

超过负载因子0.75，新数组扩大到2倍，赋值

hash & （len-1），看新len的位和hash与1是0还是1，是1则改索引，不需要重新哈希。

### 负载因子为什么0.75

空间时间的平衡（默认值），低了浪费空间，高更容易哈希冲突

## List

Vector 线程安全 2倍扩容

**CopyOnWriteArrayList** volatie修饰数组，lock写操作加锁

ArrayList 1.5倍扩容

到达容量，创建新list，复制，更新引用

选1.5是可以移位运算，速度更快

