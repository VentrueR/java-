## 创建线程

### 继承Thread

### 实现Runnable

### 实现Callable、FutureTask

## 线程操作方法

getName()、setName()

join(等待当前线程执行完毕)、sleep()、currentThread()、start()

### 线程同步

#### 同步代码块

synchornized 实例方法锁this,静态方法锁类名.class

比同步方法更颗粒

#### 同步方法 

默认锁和同步代码块相同

可读性好

### 线程通信

只能被上锁对象调用。

生产者消费者，竞争，先notifyAll再wait

#### wait

#### notify

#### notifyAll

## 线程池

### 创建线程池

ThreadpoolExecutor实现类实现接口ExcecutorService(声明七大参数)

Executor工具类

### 核心线程数

计算密集型：cpu核数+1

计算功能

IO密集型：cpu核数*2

文件操作，通信

### 七大参数

核心线程数

最大线程数

临时线程存活时间

临时线程存活时间单位

线程任务队列

线程工厂

handler线程拒绝策略

#### 拒绝策略

ThreadPoolExecutor.

AbortPolicy

DiscardPolicy超出不抛异常

DiscardOldesPolicy抛弃最久等待再加入

CallerRunsPolicy交由主线程调用

### 使用

#### 实现类

pool.executor(任务)

都会遵照线程池工作流程

Runnable直接使用

Callable要调用pool.submit(Callable)返回Future对象，且可以调用get方法

#### Executor工具类

newFixedThreadPool固定线程

newSingleThreadExecutor单线程

队列最大长度IntegerMax，任务过多会oom



newCachedThreadPool随任务增加，60s空闲销毁

线程数最大IntegerMax，线程过多oom



newScheduledThreadPoll延时定时执行任务

异常对应线程池会补充新线程

## 线程和进程

运行的程序就是一个进程。

进程包含多个线程。

### 并发和并行

前者CPU轮询，快速切换一个一个执行线程

后者是同时刻cpu执行多个线程

## ThreadLocal

### 拦截器中clear

考虑请求是否以线程池形式，不是得话 不clear也 会被回收，反之会被复用，状态污染+内存污染

