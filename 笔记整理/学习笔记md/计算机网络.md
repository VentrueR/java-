# 计算机网络

## OSI七层模型

### 应用

为计算机用户提供服务

### 表示

转化为本系统能识别的数据格式（解压缩，编解码，加解密）

### 会话

建立、管理、终止应用程序之间数据的通信会话

### 传输

负责应用层实体通信传输（关联应用层）

### 网络

数据的路由、转发、分页。（真通信传输）

### 数据链路

数据封帧、差错检测、MAC寻址

MAC地址是硬件地址

### 物理

物理设备上数据原始比特流传输

## IP地址

### 基本认识

#### 简介

属于网络层，标识了互联网或本地网络设备。

#### 作用

实现不同主机之间通信、数据传输

#### 与MAC关系

通信有无直接连接

### 基础知识

#### IP分类

##### 组成

主机号、网络号

##### 划分

网络地址、主机地址、广播地址

##### 分类

###### A、B、C类

0 128 192 按网络号分类（点分十进制）

0 10 110  二进制

24 16 8    主机号位数

最大主机个数: 2^n-2

广播地址：本地广播、直接广播

###### D、E类

D类 多播地址 1110

预留 224.0.0.0~

可用 224.0.1.0~

本地 239.0.0.0~

E类未开

##### 优缺点

优点：好判断分类 1110 看第X位

缺点：开发、上线、测试等ip分层不直观。C、B可用主机和现实需求有违背

#### 无分类地址

##### 怎么划分

192.168.0.1/24

##### 为什么划分

路由器寻址直接识别网络号

##### 子网地址

一般来说子网掩码最后八位有变化 生成子网地址 和 子网主机地址

#### 共有IP和私有IP

##### 组成数字 

A 10

B 172

C 192

##### 机构

#### 路由控制

##### 作用

网络地址用于路由控制

##### 流程

发送IP包，确认包首部目标地址，根据路由控制表，进行最长匹配，再转发

##### 环回地址

网络通信默认地址127.0.0.1。数据包不流向网络。

#### 分片与重组

超过MTU最大传输单元 1500字节

IP分片 -> 路由控制转发 -> 目标主机重组

## HTTP

### 是什么

超文本传输协议，协议包含传输包含文本。

html就是一种超文本，是文字、图片、视频、超链接的集合体。

### 常见状态码

#### 1xx 

提示信息。协议处理中间状态。

#### 2xx

成功。

200 且响应头有Body

204 响应头没有Body

206 响应头Body不全，出现在分块下载或断电传续

#### 3XX

 重定向。

301永久，请求资源不存在，修改重定向url

302 临时，请求资源存在，也需修改url

304 未修改，资源未修改，重定向缓存文件

#### 4XX

客户端错误。

400 客户端请求报文错误，笼统错误

403 服务器禁止访问资源。

404 服务端找不到资源

#### 5XX

服务器错误。

500 服务器笼统错误

501 服务器不支持客户端请求的功能

502 服务器作为网关或代理，本身正常，后端服务器有问题

503 服务器繁忙，重试。

### 常见字段

host

用于指定服务器域名

connection

长连接 设置http首部字段为Keep-Alive

content-length

响应数据长度

#### 沾包问题

1. 换行符、回车符作为head边界

2. content-length作为body边界

content-type

返回文本类型和编码类型

content-encode

返回压缩类型

### GET和POST

get请求 获取服务器资源，安全、幂等、可缓存

post请求 根据请求报文处理服务器资源，不安全、不幂等、一般不可缓存

安全：资源不被破坏（修改）

幂等：多次相同操作后，结果不变（新增）

GET请求可以带body但用不上。

### HTTP缓存

#### 强制缓存 

判断缓存未过期，直接走本地缓存

#### 协商缓存

客户端与服务器协商后，再是否走缓存

### HTTP1.1特性

#### 优点

简单 基本报文格式head和body 头部信息为key-value格式

易拓展 组成可以自定义如状态码，url

应用广泛跨平台

#### 缺点

无状态 不记录状态信息。虽然少占用了服务器资源，但关联操作上不便。

引入cookie和session

明文传输 是暴露出来的

不安全 明文传输和恶意攻击

#### 性能

长连接

管道网络运输：解决请求的队头阻塞

### http和https

#### 区别

后者加入了安全协议SSL/TLS

TCP连接三次握手后，安全协议也要握手

端口号80 443

#### 问题和解决

窃听风险 混合加密

篡改风险 摘要算法和签名 前者哈希算法，后者用非对称加密算法，私钥加密公钥解密，对内容哈希值加密，确认消息身份

冒充风险 数字证书

### http1.1、http/2、http/3

#### 1.1

在前者特性中提过。

#### 2.0(https)

头部压缩 把多个请求相同head,消除重复部分

二进制格式 转换为头信息帧和数据帧

并发运输 引入stream，不同请求对应唯一streamId，响应时按StreamId有序组成消息，所以可以并发请求和响应。

tcp层还是存在队头阻塞，tcp协议需要数据完整连续，不连续数据可能存内核缓存中，全部到达应用层才能拿到数据。

服务器推送资源 可以主动向客户端发消息

#### 3.0 

基于udp的QUIC协议

无队头阻塞 某个流丢包，只阻塞本流，不影响其他流

更快建立连接 quic协议握手

连接迁移 基于连接ID而不是四元组

## TCP

### 头格式

#### 序列号 

解决包乱序

#### 确认应答号 

解决丢包

#### 控制位 

syn 建立连接位

ack 确认连接位

fin 断开连接位

rst 异常断开连接位

### 什么是TCP

可靠、面向连接、字节流的传输层协议

数据完整、连续。一对一连接。流式传输，响应报文有序。

### 为什么需要

TCP协议确保了数据完整、非冗余、连续、有序

### TCP连接

socket、序列号、窗口大小保证可靠、流量控制的连接

IP地址和端口号。解决乱序。流量控制。

### 如何确定唯一TCP连接

源地址、源端口号、目标地址、目标端口号

### TCP最大连接

IP地址*端口号

2^32 * 2^16

受文件限制符 和 内存影响

### TCP和UDP区别、应用场景

#### 区别

TCP是什么 -> 4个点

可靠（数据完整）、面向连接（有无连接、一对？）、字节流（有无流式）。

首部（前者有可选选项）、窗口大小（有无流量控制）、分片（MSS TCP层丢失分片 只传丢失的分片\MTU IP层分片再组装）

#### 场景

前者ftp\http\https

后者dns、音视频、广播

#### 可使用同一端口

主机收到数据，先解析头部判断那种传输协议，再送至相应协议模块处理

### 三次握手

#### 过程

1. 客户端初始化syn报文序列号 syn置1 发送syn报文（发送状态）服务端接收（监听状态）
2. 服务端初始化syn+ack报文序列号,确认应答号 syn\ack置1（报文序列号+1）发送syn+ack报文（发送状态）
3. 客户端（连接状态） syn置1 发送ack报文确认应答号=syn+ack序列号+1

#### 为什么不是两次

防止历史连接 -> 同步初始化序列号、减少资源开销

####  为什么序列号不同

防止四元组重复连接

安全问题，接收伪造报文

#### 握手丢失 

超时重传，上次重传时间的两倍。最大重传次数。

第一次握手丢失 重传syn

第二次握手丢失 重传syn和 syn+ack

第三次握手丢失 重传syn+ack

#### syn攻击

伪造syn攻击服务器，服务器无法响应

## 杂

### MAC地址

网络设备在数据链路层的标识

### 网卡

网络适配器，计算机与网络的必备连接设备，有唯一MAC地址

### 网关

网络关口，协议转换器，解释器，实现两个网络之间互相通信。

### 网桥和交换机

网络设备，连接局域网，根据mac地址转发数据帧。

前者只是端口数，效率不同。

路由器根据IP转发

### DNS

域名解析协议。

#### 域名

www.baidu.com

从后往前依次分层为，根服务器，顶级服务器，权威服务器。

无缓存，走dns查ip地址

### 报文

是什么：不同OIS层数据传输单元

组成：head+body

应用层 报文

传输层 数据报

网络层 数据包

数据链路层 帧

物理层 二进制比特流

### cookie和session

前者存储在客户端，后者存储在服务端

第一次请求后，cookie由服务器创建，发送给客户端。

之后的请求都会携带cookie。

一般用cookie存sessionid在服务器与session比较

### WebSocket

tcp连接两端可以同时发送消息。

在http请求中加升级协议head头

### socket

位于应用层和传输层之间的通信接口



